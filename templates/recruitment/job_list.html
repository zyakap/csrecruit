{% extends "base.html" %}
{% load static %}

{% block title %}Job Vacancies | PNGCS Recruitment Portal{% endblock %}

{% block content %}

<!-- Hero Banner -->
<div class="hero-banner">
  <div class="container">
    <h3 class="white-text center-align" style="font-weight:700; letter-spacing:1px;">
      Papua New Guinea Civil Service Vacancies
    </h3>
    <p class="white-text center-align" style="opacity:.85; margin-bottom:1.5rem;">
      Find and apply for public service positions across all provinces.
    </p>
    <form method="get" action="" id="search-form">
      <div class="row" style="margin-bottom:0;">
        <div class="col s12 m10 offset-m1">
          <div class="input-field" style="margin:0;">
            <input id="search"
                   name="search"
                   type="search"
                   value="{{ search|default:'' }}"
                   placeholder="Search by title, department, or keywordâ€¦"
                   style="background:#fff; border-radius:4px; padding:0 1rem; height:3rem; box-shadow:0 2px 8px rgba(0,0,0,.25);">
            <label class="label-icon" for="search"><i class="material-icons" style="color:#003087;">search</i></label>
            <i class="material-icons" id="search-clear" style="cursor:pointer; color:#888;">close</i>
          </div>
        </div>
      </div>

      <!-- Filter Row -->
      <div class="row" style="margin-top:1rem; margin-bottom:0;">
        <div class="col s12 m3 offset-m1">
          <div class="input-field" style="margin:0;">
            <select name="province" id="province-filter"
                    style="background:#fff; border-radius:4px; height:2.8rem; padding:0 .75rem; border:none; box-shadow:0 1px 4px rgba(0,0,0,.2);">
              <option value="">All Provinces</option>
              {% for p in provinces %}
                <option value="{{ p }}" {% if province_filter == p %}selected{% endif %}>{{ p }}</option>
              {% endfor %}
            </select>
            <label for="province-filter" style="color:#fff;">Province</label>
          </div>
        </div>
        <div class="col s12 m3">
          <div class="input-field" style="margin:0;">
            <select name="category" id="category-filter"
                    style="background:#fff; border-radius:4px; height:2.8rem; padding:0 .75rem; border:none; box-shadow:0 1px 4px rgba(0,0,0,.2);">
              <option value="">All Categories</option>
              {% for c in categories %}
                <option value="{{ c }}" {% if category_filter == c %}selected{% endif %}>{{ c }}</option>
              {% endfor %}
            </select>
            <label for="category-filter" style="color:#fff;">Category</label>
          </div>
        </div>
        <div class="col s12 m3">
          <div class="input-field" style="margin:0;">
            <select name="qualification" id="qual-filter"
                    style="background:#fff; border-radius:4px; height:2.8rem; padding:0 .75rem; border:none; box-shadow:0 1px 4px rgba(0,0,0,.2);">
              <option value="">All Qualifications</option>
              {% for q in qualifications %}
                <option value="{{ q }}" {% if qual_filter == q %}selected{% endif %}>{{ q }}</option>
              {% endfor %}
            </select>
            <label for="qual-filter" style="color:#fff;">Qualification</label>
          </div>
        </div>
        <div class="col s12 m1" style="display:flex; align-items:center; justify-content:center; padding-top:.5rem;">
          <a href="{% url 'recruitment:job_list' %}" class="white-text" style="font-size:.85rem; text-decoration:underline; opacity:.85;">
            Clear
          </a>
        </div>
      </div>

      <!-- Hidden submit so selects trigger form -->
      <input type="submit" hidden>
    </form>
  </div>
</div><!-- /hero-banner -->

<!-- Flash Messages -->
{% if messages %}
<div class="container" style="margin-top:1rem;">
  {% for message in messages %}
    <div class="msg-flash {{ message.tags }}">
      <i class="material-icons left">
        {% if message.tags == 'success' %}check_circle
        {% elif message.tags == 'warning' %}warning
        {% else %}info{% endif %}
      </i>
      {{ message }}
    </div>
  {% endfor %}
</div>
{% endif %}

<!-- Vacancy Count Row -->
<div class="container" style="margin-top:1.5rem;">
  <div class="row valign-wrapper" style="margin-bottom:.5rem;">
    <div class="col s6">
      <span style="color:#555; font-size:.95rem;">
        <strong>{{ vacancies|length }}</strong> vacanc{{ vacancies|length|pluralize:"y,ies" }} found
      </span>
    </div>
    <div class="col s6 right-align">
      <span style="color:#888; font-size:.85rem;">
        <i class="material-icons tiny">sort</i> Sorted by closing date
      </span>
    </div>
  </div>

  <!-- Vacancy Cards Loop -->
  {% if vacancies %}
    {% for vacancy in vacancies %}
    <div class="job-card z-depth-1" data-href="{% url 'recruitment:job_detail' vacancy.pk %}">
      <div class="row valign-wrapper" style="margin:0;">

        <!-- Left: Icon + Details -->
        <div class="col s12 m8">
          <div class="row valign-wrapper" style="margin:0;">
            <!-- Job Icon -->
            <div class="col s12 m1" style="padding-right:1rem;">
              <div class="job-icon">
                <i class="material-icons">work_outline</i>
              </div>
            </div>
            <!-- Details -->
            <div class="col s12 m11">
              <h5 style="margin:0 0 .35rem 0; font-size:1.15rem; font-weight:600; color:#003087;">
                {{ vacancy.title }}
              </h5>
              <div style="margin-bottom:.5rem;">
                <!-- Department chip -->
                <span class="chip" style="background:#E8EDF5; color:#003087; font-size:.78rem;">
                  <i class="material-icons tiny" style="margin-right:3px;">account_balance</i>
                  {{ vacancy.department }}
                </span>
                <!-- Province chip -->
                <span class="chip" style="background:#E8EDF5; color:#003087; font-size:.78rem;">
                  <i class="material-icons tiny" style="margin-right:3px;">location_on</i>
                  {{ vacancy.province }}
                </span>
              </div>
              <div>
                <!-- Category chip -->
                {% if vacancy.category %}
                <span class="chip" style="background:#FFF8DC; color:#7a6000; font-size:.75rem;">
                  {{ vacancy.category }}
                </span>
                {% endif %}
                <!-- Qualification chip -->
                {% if vacancy.required_qualification %}
                <span class="chip" style="background:#F0F7F0; color:#2e6b30; font-size:.75rem;">
                  <i class="material-icons tiny" style="margin-right:2px;">school</i>
                  {{ vacancy.required_qualification }}
                </span>
                {% endif %}
              </div>
            </div>
          </div>
        </div>

        <!-- Right: Close date, positions, action -->
        <div class="col s12 m4" style="text-align:right;">
          <div style="margin-bottom:.6rem;">
            <span style="font-size:.8rem; color:#c62828; font-weight:600;">
              <i class="material-icons tiny" style="vertical-align:middle;">event</i>
              Closes: {{ vacancy.closing_date|date:"d M Y" }}
            </span>
          </div>
          <div style="margin-bottom:.8rem;">
            <span class="new badge" data-badge-caption="position{{ vacancy.positions|pluralize }}"
                  style="background:#003087; font-size:.78rem;">
              {{ vacancy.positions }}
            </span>
          </div>
          <a href="{% url 'recruitment:job_detail' vacancy.pk %}"
             class="btn pngcs waves-effect waves-light"
             style="font-size:.82rem; padding:0 1rem; height:2rem; line-height:2rem;"
             onclick="event.stopPropagation();">
            <i class="material-icons left" style="font-size:1rem; line-height:2rem;">visibility</i>
            View &amp; Apply
          </a>
        </div>

      </div>
    </div><!-- /job-card -->
    {% endfor %}

  {% else %}
    <!-- Empty State -->
    <div class="empty-state">
      <i class="material-icons" style="font-size:4rem; color:#bbb; display:block; margin-bottom:.75rem;">search_off</i>
      <h5 style="color:#888; margin:0 0 .5rem 0;">No vacancies found</h5>
      <p style="color:#aaa; margin:0 0 1.25rem 0;">
        Try adjusting your search terms or filters to find available positions.
      </p>
      <a href="{% url 'recruitment:job_list' %}" class="btn pngcs waves-effect waves-light">
        <i class="material-icons left">refresh</i>Clear Filters
      </a>
    </div>
  {% endif %}

</div><!-- /container -->

{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Auto-submit form on select change
    ['province-filter', 'category-filter', 'qual-filter'].forEach(function (id) {
      var el = document.getElementById(id);
      if (el) {
        el.addEventListener('change', function () {
          document.getElementById('search-form').submit();
        });
      }
    });

    // Search clear button
    var clearBtn = document.getElementById('search-clear');
    var searchInput = document.getElementById('search');
    if (clearBtn && searchInput) {
      clearBtn.style.display = searchInput.value ? 'block' : 'none';
      searchInput.addEventListener('input', function () {
        clearBtn.style.display = this.value ? 'block' : 'none';
      });
      clearBtn.addEventListener('click', function () {
        searchInput.value = '';
        clearBtn.style.display = 'none';
        document.getElementById('search-form').submit();
      });
    }

    // Clickable job cards
    document.querySelectorAll('.job-card[data-href]').forEach(function (card) {
      card.style.cursor = 'pointer';
      card.addEventListener('click', function () {
        window.location.href = this.dataset.href;
      });
    });

    // Hover z-depth effect
    document.querySelectorAll('.job-card').forEach(function (card) {
      card.addEventListener('mouseenter', function () {
        this.classList.remove('z-depth-1');
        this.classList.add('z-depth-3');
      });
      card.addEventListener('mouseleave', function () {
        this.classList.remove('z-depth-3');
        this.classList.add('z-depth-1');
      });
    });
  });
</script>
{% endblock %}
