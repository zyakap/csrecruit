{% extends "base.html" %}
{% load static %}

{% block title %}{{ vacancy.title }} | PNGCS Recruitment Portal{% endblock %}

{% block content %}

<!-- Breadcrumb -->
<div style="background:#003087; padding:.6rem 0;">
  <div class="container">
    <nav style="background:transparent; box-shadow:none; height:auto; line-height:normal;">
      <div class="nav-wrapper">
        <div class="col s12" style="padding:0;">
          <a href="{% url 'recruitment:job_list' %}" class="breadcrumb white-text"
             style="font-size:.9rem; opacity:.85;">Vacancies</a>
          <span class="breadcrumb white-text" style="font-size:.9rem; font-weight:600;">
            {{ vacancy.title }}
          </span>
        </div>
      </div>
    </nav>
  </div>
</div>

{% if messages %}
<div class="container" style="margin-top:1rem;">
  {% for message in messages %}
    <div class="msg-flash {{ message.tags }}">
      <i class="material-icons left">
        {% if message.tags == 'success' %}check_circle
        {% elif message.tags == 'warning' %}warning
        {% else %}info{% endif %}
      </i>
      {{ message }}
    </div>
  {% endfor %}
</div>
{% endif %}

<div class="container" style="margin-top:1.5rem; margin-bottom:3rem;">
  <div class="row">

    <!-- LEFT COLUMN: Job Details -->
    <div class="col s12 m8">
      <div class="card z-depth-1" style="border-radius:6px; overflow:visible;">
        <div class="card-content">

          <!-- Title + Reference -->
          <div style="margin-bottom:1rem;">
            <h4 style="margin:0 0 .5rem 0; font-size:1.5rem; font-weight:700; color:#003087; line-height:1.3;">
              {{ vacancy.title }}
            </h4>
            <span class="chip" style="background:#E8EDF5; color:#003087; font-weight:600; font-size:.8rem;">
              <i class="material-icons tiny" style="margin-right:3px;">tag</i>
              Ref: {{ vacancy.reference_number|default:vacancy.pk }}
            </span>
            <span class="chip" style="background:#E8EDF5; color:#003087; font-size:.8rem;">
              <i class="material-icons tiny" style="margin-right:3px;">account_balance</i>
              {{ vacancy.department }}
            </span>
            <span class="chip" style="background:#E8EDF5; color:#003087; font-size:.8rem;">
              <i class="material-icons tiny" style="margin-right:3px;">location_on</i>
              {{ vacancy.province }}
            </span>
          </div>

          <div class="section-divider"></div>

          <!-- Description Section -->
          <div style="margin-bottom:1.25rem;">
            <h6 style="font-weight:700; color:#003087; font-size:1rem; margin:0 0 .75rem 0; display:flex; align-items:center; gap:.4rem;">
              <i class="material-icons small" style="color:#FFD700;">description</i>
              Position Description
            </h6>
            <div style="color:#444; line-height:1.75; font-size:.95rem;">
              {{ vacancy.description|linebreaks }}
            </div>
          </div>

          <div class="section-divider"></div>

          <!-- Requirements Section -->
          <div style="margin-bottom:1.25rem;">
            <h6 style="font-weight:700; color:#003087; font-size:1rem; margin:0 0 .75rem 0; display:flex; align-items:center; gap:.4rem;">
              <i class="material-icons small" style="color:#FFD700;">checklist</i>
              Selection Criteria &amp; Requirements
            </h6>
            <div style="color:#444; line-height:1.75; font-size:.95rem;">
              {% if vacancy.requirements %}
                {{ vacancy.requirements|linebreaks }}
              {% else %}
                <p style="color:#999; font-style:italic;">No specific requirements listed.</p>
              {% endif %}
            </div>
          </div>

          {% if vacancy.duties %}
          <div class="section-divider"></div>
          <div style="margin-bottom:1.25rem;">
            <h6 style="font-weight:700; color:#003087; font-size:1rem; margin:0 0 .75rem 0; display:flex; align-items:center; gap:.4rem;">
              <i class="material-icons small" style="color:#FFD700;">assignment</i>
              Key Duties &amp; Responsibilities
            </h6>
            <div style="color:#444; line-height:1.75; font-size:.95rem;">
              {{ vacancy.duties|linebreaks }}
            </div>
          </div>
          {% endif %}

        </div><!-- /card-content -->
      </div><!-- /card -->
    </div><!-- /left col -->

    <!-- RIGHT COLUMN: Position Details Sticky Card + Apply -->
    <div class="col s12 m4">
      <div style="position:sticky; top:80px;">

        <!-- Position Details Card -->
        <div class="card z-depth-1" style="border-radius:6px;">
          <div class="card-content" style="padding:1.25rem;">
            <h6 style="font-weight:700; color:#003087; margin:0 0 1rem 0; font-size:1rem; border-bottom:2px solid #FFD700; padding-bottom:.5rem;">
              <i class="material-icons tiny" style="vertical-align:middle; margin-right:4px;">info</i>
              Position Details
            </h6>

            <table style="font-size:.88rem; width:100%; border-collapse:collapse;">
              <tbody>
                <tr style="border-bottom:1px solid #f0f0f0;">
                  <td style="padding:.5rem .25rem; color:#888; width:45%;">
                    <i class="material-icons tiny" style="vertical-align:middle; margin-right:3px; color:#003087;">category</i>
                    Category
                  </td>
                  <td style="padding:.5rem .25rem; color:#333; font-weight:500;">
                    {{ vacancy.category|default:"—" }}
                  </td>
                </tr>
                <tr style="border-bottom:1px solid #f0f0f0;">
                  <td style="padding:.5rem .25rem; color:#888;">
                    <i class="material-icons tiny" style="vertical-align:middle; margin-right:3px; color:#003087;">school</i>
                    Qualification
                  </td>
                  <td style="padding:.5rem .25rem; color:#333; font-weight:500;">
                    {{ vacancy.required_qualification|default:"—" }}
                  </td>
                </tr>
                <tr style="border-bottom:1px solid #f0f0f0;">
                  <td style="padding:.5rem .25rem; color:#888;">
                    <i class="material-icons tiny" style="vertical-align:middle; margin-right:3px; color:#003087;">group</i>
                    Positions
                  </td>
                  <td style="padding:.5rem .25rem; color:#333; font-weight:500;">
                    {{ vacancy.positions }}
                  </td>
                </tr>
                <tr style="border-bottom:1px solid #f0f0f0;">
                  <td style="padding:.5rem .25rem; color:#888;">
                    <i class="material-icons tiny" style="vertical-align:middle; margin-right:3px; color:#003087;">payments</i>
                    Salary Band
                  </td>
                  <td style="padding:.5rem .25rem; color:#333; font-weight:500;">
                    {% if vacancy.salary_min and vacancy.salary_max %}
                      K{{ vacancy.salary_min|floatformat:0 }} – K{{ vacancy.salary_max|floatformat:0 }}
                    {% elif vacancy.salary_band %}
                      {{ vacancy.salary_band }}
                    {% else %}
                      <span style="color:#aaa;">Not specified</span>
                    {% endif %}
                  </td>
                </tr>
                <tr style="border-bottom:1px solid #f0f0f0;">
                  <td style="padding:.5rem .25rem; color:#888;">
                    <i class="material-icons tiny" style="vertical-align:middle; margin-right:3px; color:#003087;">event_available</i>
                    Posted
                  </td>
                  <td style="padding:.5rem .25rem; color:#333; font-weight:500;">
                    {{ vacancy.posted_date|date:"d M Y"|default:"—" }}
                  </td>
                </tr>
                <tr>
                  <td style="padding:.5rem .25rem; color:#888;">
                    <i class="material-icons tiny" style="vertical-align:middle; margin-right:3px; color:#c62828;">event_busy</i>
                    Closes
                  </td>
                  <td style="padding:.5rem .25rem; color:#c62828; font-weight:700;">
                    {{ vacancy.closing_date|date:"d M Y" }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div><!-- /card-content -->
        </div><!-- /details card -->

        <!-- Apply Card -->
        <div class="card z-depth-1" style="border-radius:6px;">
          <div class="card-content" style="padding:1.25rem; text-align:center;">
            {% if user.is_authenticated %}
              {% if already_applied %}
                <div style="margin-bottom:.75rem;">
                  <i class="material-icons" style="color:#43a047; font-size:2.5rem;">check_circle</i>
                  <p style="color:#43a047; font-weight:600; margin:.25rem 0 0 0; font-size:.95rem;">
                    You have already applied for this position.
                  </p>
                </div>
                <a href="{% url 'recruitment:dashboard' %}" class="btn-flat waves-effect pngcs-text" style="font-size:.88rem;">
                  <i class="material-icons left">dashboard</i>View My Applications
                </a>
                <div style="margin-top:.75rem;">
                  <button class="btn pngcs waves-effect waves-light disabled" disabled
                          style="width:100%; font-size:.9rem; letter-spacing:.5px;">
                    <i class="material-icons left">how_to_reg</i>Already Applied
                  </button>
                </div>
              {% else %}
                <p style="color:#555; font-size:.9rem; margin-bottom:1rem;">
                  Ready to apply? Submit your application for this position.
                </p>
                <a href="{% url 'recruitment:apply' vacancy.pk %}"
                   class="btn pngcs waves-effect waves-light"
                   style="width:100%; font-size:.95rem; letter-spacing:.5px; height:2.75rem; line-height:2.75rem;">
                  <i class="material-icons left">send</i>Apply Now
                </a>
              {% endif %}
            {% else %}
              <div style="margin-bottom:.75rem;">
                <i class="material-icons" style="color:#FFD700; font-size:2.5rem;">lock</i>
                <p style="color:#555; font-size:.9rem; margin:.5rem 0 0 0;">
                  You must be logged in to apply for this position.
                </p>
              </div>
              <a href="{% url 'accounts:login' %}?next={{ request.path }}"
                 class="btn pngcs waves-effect waves-light"
                 style="width:100%; font-size:.9rem; margin-bottom:.5rem; height:2.5rem; line-height:2.5rem;">
                <i class="material-icons left">login</i>Login to Apply
              </a>
              <p style="color:#999; font-size:.82rem; margin:0;">
                Don't have an account?
                <a href="{% url 'accounts:register' %}" style="color:#003087; font-weight:600;">Register here</a>
              </p>
            {% endif %}
          </div>
        </div><!-- /apply card -->

      </div><!-- /sticky wrapper -->
    </div><!-- /right col -->

  </div><!-- /row -->
</div><!-- /container -->

{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Nothing additional needed; Materialize handles any components
  });
</script>
{% endblock %}
